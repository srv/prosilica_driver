#! /usr/bin/env python3

PACKAGE='prosilica_camera'

from dynamic_reconfigure.parameter_generator_catkin import *

class SensorLevels:
    RECONFIGURE_RUNNING = 0
    RECONFIGURE_STOP = 1

gen = ParameterGenerator()

trigger_source_enum = gen.enum( [ gen.const("StreamingMode", str_t, "streaming", "Run at maximum frame rate"),
                        gen.const("SoftwareMode",  str_t, "software",  "Trigger from software"),
                        gen.const("PolledMode",    str_t, "polled",    "Capture frame in response to service call"),
                        gen.const("TriggerMode",   str_t, "triggered", "Capture frame in response to trigger topic"),
                        gen.const("FixedRateMode", str_t, "fixedrate", "Fixed Rate mode"),
                        gen.const("External1Mode", str_t, "syncin1",   "External trigger on SyncIn1 line"),
                        gen.const("External2Mode", str_t, "syncin2",   "External trigger on SyncIn2 line") ],
                      "Enum to set the trigger mode")

sync_out_selector_enum = gen.enum([ gen.const("SyncOut1", str_t, "SyncOut1", ""),
                        gen.const("SyncOut2",  str_t, "SyncOut2", ""),
                        gen.const("SyncOut3",  str_t, "SyncOut3", ""),
                        gen.const("SyncOut4",  str_t, "SyncOut4", "")],
                        "Sync-out selector")

# Monochrome cameras have mono8,12 and 12Packed. Color cameras have only mono8.
pixelformat_enum = gen.enum([ gen.const("Mono8",            str_t,  "Mono8", ""),
                              gen.const("Mono16",           str_t,  "Mono16", ""),
                              gen.const("Bayer8",           str_t,  "Bayer8", ""),
                              gen.const("Bayer16",          str_t,  "Bayer16", ""),
                              gen.const("Rgb24",            str_t,  "Rgb24", ""),
                              gen.const("Bgr24",            str_t,  "Bgr24", ""),
                              gen.const("Yuv411",           str_t,  "Yuv411", ""),
                              gen.const("Yuv422",           str_t,  "Yuv422", ""),
                              gen.const("Yuv444",           str_t,  "Yuv444", ""),
                              gen.const("Rgba32",           str_t,  "Rgba32", ""),
                              gen.const("Bgra32",           str_t,  "Bgra32", ""),
                              gen.const("Rgb48",            str_t,  "Rgb48", ""),
                              gen.const("Mono12Packed",     str_t,  "Mono12Packed", ""),
                              gen.const("Bayer12Packed",    str_t,  "Bayer12Packed", "")],
                              "Set Pixel Format")

#       Name                    Type      Reconfiguration level             Description         Default   Min   Max
gen.add("trigger_mode",         str_t,    SensorLevels.RECONFIGURE_STOP,    "Camera trigger mode", "fixedrate", edit_method = trigger_source_enum)
gen.add("sync_out_selector",    str_t,    SensorLevels.RECONFIGURE_STOP,    "Selects the sync-out line to control", "SyncOut1", edit_method=sync_out_selector_enum)
gen.add("pixel_format",         str_t,    SensorLevels.RECONFIGURE_STOP,    "Format of the image data.", "Bayer8", edit_method=pixelformat_enum)
gen.add("trig_rate",            double_t, SensorLevels.RECONFIGURE_STOP,    "Sets the expected triggering rate in externally triggered mode.", 1, 1, 100)
gen.add("auto_exposure",        bool_t,   SensorLevels.RECONFIGURE_RUNNING, "Sets the camera exposure duration to automatic. Causes the `~exposure` setting to be ignored.", True)
gen.add("exposure",             double_t, SensorLevels.RECONFIGURE_RUNNING, "Camera exposure time in seconds.", 0.025, 0.000025, 60.0)
gen.add("auto_gain",            bool_t,   SensorLevels.RECONFIGURE_RUNNING, "Sets the analog gain to automatic. Causes the `~gain` setting to be ignored.", True)
gen.add("gain",                 int_t,    SensorLevels.RECONFIGURE_RUNNING, "The gain level in dB.", 0, 0, 24)
gen.add("auto_whitebalance",    bool_t,   SensorLevels.RECONFIGURE_RUNNING, "Whether whitebalance will continuously adjust to the current scene. Causes the `~whitebalance_red` and `~whitebalance_blue` settings to be ignored.", True)
gen.add("whitebalance_red",     int_t,    SensorLevels.RECONFIGURE_RUNNING, "Red gain as a percentage of the camera default setting.", 100, 80, 300)
gen.add("whitebalance_blue",    int_t,    SensorLevels.RECONFIGURE_RUNNING, "Blue gain as a percentage of the camera default setting.", 100, 80, 300)
gen.add("binning_x",            int_t,    SensorLevels.RECONFIGURE_RUNNING, "Number of pixels to bin together horizontally.", 1, 1, 8)
gen.add("binning_y",            int_t,    SensorLevels.RECONFIGURE_RUNNING, "Number of pixels to bin together vertically.", 1, 1, 14)
gen.add("decimation_x",         int_t,    SensorLevels.RECONFIGURE_RUNNING, "Number of pixels to decimate together horizontally.", 1, 1, 8)
gen.add("decimation_y",         int_t,    SensorLevels.RECONFIGURE_RUNNING, "Number of pixels to decimate together vertically.", 1, 1, 14)
gen.add("x_offset",             int_t,    SensorLevels.RECONFIGURE_RUNNING, "X offset of the region of interest.", 0, 0, 2447)
gen.add("y_offset",             int_t,    SensorLevels.RECONFIGURE_RUNNING, "Y offset of the region of interest.", 0, 0, 2049)
gen.add("width",                int_t,    SensorLevels.RECONFIGURE_RUNNING, "Width of the region of interest (0 for automatic).", 0, 0, 2448)
gen.add("height",               int_t,    SensorLevels.RECONFIGURE_RUNNING, "Height of the region of interest (0 for automatic).", 0, 0, 2050)
gen.add("frame_id",             str_t,    SensorLevels.RECONFIGURE_RUNNING, "The optical camera TF frame set in message headers.", "")
gen.add("trig_timestamp_topic", str_t,    SensorLevels.RECONFIGURE_STOP,    "Sets the topic from which an externally trigged camera receives its trigger timestamps.", "trigger")
gen.add("auto_adjust_stream_bytes_per_second", bool_t, SensorLevels.RECONFIGURE_RUNNING, "Whether the node should automatically adjust the data rate. Causes `~stream_bytes_per_second` to be ignored.", True)
gen.add("stream_bytes_per_second", int_t, SensorLevels.RECONFIGURE_RUNNING, "Limits the data rate of the camera.", 45000000, 1, 115000000)
gen.add("exposure_auto_max",    double_t, SensorLevels.RECONFIGURE_RUNNING, "The max exposure time in auto exposure mode, in seconds.", 0.5, 0.000025, 60.0)
gen.add("exposure_auto_target", int_t,    SensorLevels.RECONFIGURE_RUNNING, "The auto exposure target mean value as a percentage, from 0=black to 100=white.", 50, 0, 100)
gen.add("gain_auto_max",        int_t,    SensorLevels.RECONFIGURE_RUNNING, "The max gain level in auto gain mode, in dB.", 24, 0, 24)
gen.add("gain_auto_target",     int_t,    SensorLevels.RECONFIGURE_RUNNING, "The auto gain target mean value as a percentage, from 0=black to 100=white.", 50, 0, 100)

exit(gen.generate(PACKAGE, "prosilica_driver", "ProsilicaCamera"))

